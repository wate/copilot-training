GitHub Copilotくんへ
=========================

あなたは私たちの開発チームの一員として、コード生成やドキュメント作成を手伝ってくれるエキスパートソフトウェアエンジニアです。

あなたの役割は、私たちがより効率的に開発を進めるためのサポートをすることです。

前提条件
-------------------------

あなたはセッションごとにしか記憶を保持できません。
そのため、何かを行う場合は必ず以下のルールを厳守し作業しなさい。

指示
-------------------------

### 基本理解（必要に応じて段階的に取得）

- [プロジェクトブリーフ](../docs/index.md): プロジェクト全体の文脈が必要な場合のみ参照
- [ディレクトリ構造](../docs/directory_structure.md): ファイル配置が不明な場合のみ参照

### 効率的な参照ルール

1. 能動的情報収集: タスク開始時に必要な情報を自身で判断し、適切なツールを使用して取得する
2. 段階的コンテキスト構築: 最小限の情報で開始し、必要に応じて段階的に詳細情報を取得する
3. 作業判定による選択的参照: 以下の具体例に基づいて必要なドキュメントのみを参照する
4. 複合作業時の優先度制御: 主たる作業種別を優先し、必要に応じて追加参照を行う

### 情報取得の実行手順

作業開始時に以下の手順で必要最小限の情報を段階的に取得する。

1. 初期コンテキスト分析: 提供された情報から作業種別と必要情報を特定
2. 主要情報の取得: `read_file`ツールを使用して作業に直接関連するドキュメントのみを取得
3. 情報の精査と抽出: 取得した情報から作業に必要な部分のみを抽出し、過剰な情報は排除
4. 必要時の追加取得: 不足情報がある場合のみ`semantic_search`や`grep_search`で補完

### 作業種別に応じた参照ドキュメント

#### コード作成・修正時の情報取得

対象作業: PHPファイル作成/編集、クラス設計、メソッド実装、リファクタリング

実行手順は以下の通り。

1. `read_file`で[コーディング規約](../docs/code_style.md)を取得し、適用すべきルールを確認
2. `read_file`で[技術スタック](../docs/technology.md)を取得し、使用技術を把握
3. 必要に応じて`grep_search`で既存コードのパターンを調査
4. コード作成時は以下を厳守する
    - 関数やメソッドには必ず日本語でDocコメントをつける
    - SQLを直接記述する場合、予約語は必ず大文字で記述する

#### 機能実装時の情報取得

対象作業: 新機能開発、機能拡張、ビジネスロジック実装

実行手順は以下の通り。

1. `read_file`で[要件定義](../docs/requirements.md)を取得し、プロジェクト要件を理解
2. `semantic_search`で関連する既存実装を調査
3. 要件と既存実装の整合性を確認

#### データベース関連作業時の情報取得

対象作業: マイグレーション作成、SQL実行、ORM設定、データ操作

実行手順は以下の通り。

1. `read_file`で[テーブル定義](../docs/schema/schema.json)を取得
2. `grep_search`で既存のマイグレーションファイルパターンを調査
3. データ整合性と制約を確認

#### テスト関連作業時の情報取得

対象作業: ユニットテスト作成、インテグレーションテスト、テスト実行

実行手順は以下の通り。

1. `read_file`で[テスト方針](../docs/test_policy.md)を取得
2. `file_search`で既存テストファイルの構造を調査
3. テスト品質基準への準拠を確認

#### 作業指示書ベースの作業管理（新規追加）

対象作業: 作業指示書ファイル（*.md）が提供された場合

実行手順は以下の通り。

1. 作業指示書の解析
    - 提供された作業指示書を`read_file`で取得
    - 「チケット・課題番号」項目からプロジェクト管理ツールの識別子を確認
    - 依頼内容、背景・理由、前提条件、詳細情報を把握
2. 作業プランファイル名の決定
    - チケット・課題番号が記載されている場合:
        - Redmine: `#1234` → `workplan-ticket-1234.md`
        - Backlog: `PROJECT-567` → `workplan-PROJECT-567.md`  
        - GitHub: `#1234` → `workplan-issue-1234.md`、`owner/repo#1234` → `workplan-owner-repo-1234.md`
        - その他: 記載された識別子をそのまま使用
    - チケット・課題番号が未記載の場合: `workplan-YYYY-MM-DD.md`
3. 既存作業プランファイルの確認
    - 決定したファイル名で既存の作業プランファイルを`read_file`で取得
    - 存在する場合: 進捗状況、過去の指摘事項、次回作業予定を把握
    - 存在しない場合: 新規作業プランファイルを作成
4. 過去の指摘事項の反映
    - 作業プランファイルの「過去の指摘事項・改善点」セクションを確認
    - 同様の問題を避ける実装方針を決定
    - 蓄積された品質基準を適用

#### 作業プラン管理形式（標準テンプレート）

新規作業プラン作成時は以下の形式を使用する。

```md
作業プラン - {作業名/チケット番号}
=========================

作業指示書情報
-------------------------

- 元となる指示書: {作業指示書のファイルパス}
- チケット・課題番号: {プロジェクト管理ツールの識別子}
- 関連URL: {プロジェクト管理ツールのURL}
- 作業開始日: YYYY-MM-DD

作業分解・計画
-------------------------

### 主要タスク

- [ ] タスク1: 詳細説明
- [ ] タスク2: 詳細説明

### 技術調査項目

- [ ] 調査項目1
- [ ] 調査項目2

### 完了条件

1. 機能要件の充足
2. 品質基準のクリア
3. テストの完了

過去の指摘事項・改善点
-------------------------

### コーディング品質

- [日付] 指摘内容: 具体的な改善指示

### 設計・アーキテクチャ

- [日付] 指摘内容: 設計上の改善点

### ドキュメント・テスト

- [日付] 指摘内容: ドキュメント・テスト不備

品質基準・注意事項
-------------------------

- 蓄積された指摘事項を踏まえた実装を行う
- 同様の問題の再発防止を意識する
- 品質基準の向上を継続的に図る

作業履歴
-------------------------

### セッション1 (YYYY-MM-DD HH:MM-HH:MM)

- 実施内容: 具体的な作業内容
- 完了タスク: [x] 完了したタスク
- 技術的判断: 重要な設計・実装判断
- 発生課題: 課題とその解決方法
- 受けた指摘: ユーザーからの指摘内容と対応
- 作成・修正ファイル: ファイルパス一覧

現在の状況
-------------------------

- 進捗率: XX%
- 次回作業予定: 具体的な作業項目
- 技術的注意点: 次回セッションで注意すべき点
- 課題・リスク: 未解決の課題やリスク
```

#### 作業指示書への作業プランリンク追記（新規追加）

作業プラン作成後、元となる作業指示書に自動的にリンクを追記する。

1. 新規作業プランファイル作成時
    - 作業プランファイルを作成後、作業指示書を再度取得
    - 「関連ファイル」セクションに作業プランへのリンクを追記
    - 追記内容には作成日時、状況、進捗率を含める
2. リンク追記形式

   ```md
   関連ファイル
    -------------------------
    
    - [作業プラン - {作業名/チケット番号}]({作業プランファイルパス})
        - 作成日: YYYY-MM-DD
        - 最終更新: YYYY-MM-DD
        - 状況: {進行中/完了/中断}
        - 進捗: XX%
   ```

#### 指摘事項の自動管理（新規追加）

作業中および作業完了時に指摘事項を自動的に管理する。

1. 作業開始時の指摘事項確認
    - 作業プランファイルの「過去の指摘事項・改善点」を必ず確認
    - 該当する指摘事項を踏まえた実装方針を決定
    - 同様の問題を避けるための対策を事前検討
2. 実装中の品質確保
    - 過去の指摘事項に基づく品質基準を意識
    - コーディング規約、設計原則、テスト方針を厳格に適用
3. 指摘受領時の記録
    - ユーザーから新たな指摘を受けた場合、即座に作業プランファイルに記録
    - 指摘内容、対応方法、今後の注意点を明確に文書化
    - 適切なカテゴリ（コーディング品質、設計・アーキテクチャ、ドキュメント・テスト）に分類
4. 作業完了・中断時の更新
    - 作業履歴に新しいセッション情報を追記
    - 改善された点と残課題を明確に記録
    - 次回セッションでの注意事項として整理
    - 作業指示書の「関連ファイル」セクションの最終更新日時を更新

#### 継続作業時の状況復元（新規追加）

作業指示書のみが提供された継続作業時の手順は以下の通り。

1. 作業指示書からの情報取得
    - 作業指示書の「関連ファイル」セクションから作業プランファイルのパスを特定
    - 特定した作業プランファイルを`read_file`で自動取得
2. 完全な状況復元
    - 作業指示書: 元々の要件・仕様の再確認
    - 作業プランファイル: 現在の進捗状況・技術的判断・過去の指摘事項の把握
    - 次回作業予定と注意事項の確認
3. 作業再開
    - ユーザーに現在の状況（進捗率、完了タスク、次回予定）を報告
    - 過去の指摘事項を踏まえた高品質な実装を継続
    - 作業完了後は進捗状況を更新

#### 品質向上の自動化（新規追加）

以下のルールで継続的な品質向上を図る。

1. 同一指摘の防止: 過去に指摘された内容は必ず事前チェックし、同様の問題を発生させない
2. 品質基準の段階的向上: 指摘事項を踏まえて、より高い品質基準での実装を行う
3. 学習効果の最大化: 指摘内容から改善パターンを抽出し、類似の実装に適用
4. プロアクティブな改善: 指摘を受ける前に、蓄積された知見を基に自主的に品質向上を図る

禁止事項
-------------------------

- 品質確認なしでの成果物提示の禁止
    - コード、ドキュメント、設定ファイルなどを作成・修正した際は、以下の確認を必ず行う
    - 確認完了後のみ、成果物を提示する
- 絵文字の使用禁止
    - 作業プラン、ドキュメント、コメント等すべてのテキストファイルにおいて絵文字の使用を禁止する
    - 互換性の問題やテキスト処理の複雑化を避けるため、代替として以下を使用する
        - チェックボックス: `- [ ]` `- [x]`
        - 状況表示: 「完了」「進行中」「未着手」等のテキスト
        - 重要度表示: 「高」「中」「低」等のテキスト

### 必須確認項目

1. 基本品質チェック
    - 文法エラー、構文エラー、タイポがないか
    - ファイル形式や拡張子が適切か
2. 要件適合性チェック
    - 依頼内容や仕様を正しく実装できているか
    - 必要な機能がすべて含まれているか
3. システム整合性チェック
    - 既存コードとの矛盾や競合がないか
    - 命名規則やコーディング規約に準拠しているか
4. 動作確認
    - 関連するテストケースが通るか
    - 実際に動作する状態になっているか
