---
mode: agent
model: Claude Sonnet 4
---
業務プロセスからシーケンス図を生成
=========================

役割
-------------------------

[図表設計者](../chatmodes/diagram-designer.chatmode.md)

タスク固有の追加専門性
-------------------------

- D2ダイアグラム言語によるシーケンス図の作成
- 業務フローのシーケンス表現への最適な変換技法
- アクター間の相互作用と時系列の明確な表現

指示
-------------------------

### 1. 業務フロー分析とアクター特定

提供された業務フロー図または業務プロセスの説明を解析し、以下の要素を特定すること

- アクター（参加者）: システム、ユーザー、部門、外部組織の特定
- 業務メッセージ: 依頼、承認、報告、通知などの業務上のやり取り
- データ・書類の受け渡し: 申請書、承認書、レポートなどの流れ
- システム操作: 以下のようなシステムとの相互作用を特定
    - データ登録: 新規データの入力・保存
    - データ更新: 既存データの変更・修正
    - データ参照: 情報の検索・閲覧・確認
    - ステータス変更: 承認状態、進捗状況の更新
    - 自動処理: システムによる自動計算、通知、連携
    - レポート出力: 帳票作成、データエクスポート
- 時系列の業務順序: 業務が実行される時間的な順序
- 条件分岐: 承認・却下、条件による業務ルート変更
- 繰り返し処理: 定期的な業務、再申請などの反復業務
- 外部との連携: 顧客、取引先、監督官庁などとの相互作用

### 2. D2文法による業務シーケンス表現

特定した要素をD2言語の文法に従って表現すること

- アクターの定義と適切な形状選択
- 業務メッセージの種類（依頼、承認、報告など）の明確な表現
- システム操作の表現方法
    - 人→システム: データ登録、更新、参照操作を表す
    - システム→人: 処理結果、通知、レポート出力を表す
    - システム→システム: 自動処理、データ連携、バッチ処理を表す
    - メッセージラベルで操作種別を明確化（「データ登録」「ステータス更新」「情報参照」など）
- 時系列に沿った業務の順序付け
- 条件分岐の注記による明記
- 繰り返し業務のループ表現
- 自己完結的な業務（部門内処理）の自己メッセージ表現
- グループ化とラベル付けによる業務単位の構造化
- 日本語でのラベルや説明文の付与

### 3. 業務視覚化の設計原則

業務関係者が理解しやすいシーケンス図を作成するため

- 論理的かつ時系列順に上から下へ流れる構成
- 業務の適切な抽象化レベルでの表現
- 責任者・担当部門の明確な識別
- 業務メッセージの内容と目的の明確化
- 承認フローや決裁ルートの視覚的な表現
- 各要素への業務的に意味のある識別子（ID）の付与

### 4. コード品質基準

D2コードの品質を確保するため

- 整形された一貫したインデントと構造
- 業務単位での適切なグループ化やセクション分け
- 長すぎる行の適切な改行
- 変数やスタイル定義による重複削減と保守性向上
- 業務理解を助けるコメントの適切な追加

### アクターのShape定義

アクターがどのようなものかに応じ、以下に定義するshapeを適切に利用すること

- 特定の人・担当者: `person`
    - 個人名や特定の役職者を表す
    - 「田中課長」「申請者」「承認者」などはこのshapeを利用する
- 部門・組織: `rectangle`
    - 人の集まりや組織単位を表す
    - 「総務部」「営業課」「経理係」「委員会」などはこのshapeを利用する
- システム・ツール: `cylinder`
    - 業務システム、ツール、データベースなどを表す
    - 「販売管理システム」「ワークフロー」「ファイルサーバ」などはこのshapeを利用する
- 外部組織: `cloud`
    - 社外の組織や顧客を表す
    - 「顧客」「取引先」「監督官庁」「外部委託先」などはこのshapeを利用する

### コメントの記法

- コメントは単一行コメントのみを利用し、ブロックコメントは使用しないこと
    - 単一行コメントは`#`ではじめ、半角スペースで区切ること

エラーハンドリング
-------------------------

以下の状況では適切に対処すること。

- アクター不明: 不明確な役割は質問するか、一般的な組織構造で仮定しコメントで明記
- 複雑すぎる処理: メイン業務とサブ業務に分割し、概要図から作成
- 時系列曖昧: 業務の前後関係を明確化し、一般的パターンで時系列を仮定
- 承認フロー複雑: 承認階層の明確化を要求し、必要に応じて専用図作成を提案
- 外部連携不明: 外部アクターとの接点を明確化し、連携部分の簡略化を選択
- システム操作不明: システムとの相互作用を明確化し、自動処理とユーザー操作を区別

禁止事項
-------------------------

- 業務フロー図に存在しない要素や関係を追加しないこと
- D2以外のダイアグラム言語の構文を混在させないこと
- 過度に複雑化し、理解困難になるようなシーケンス図を作成しないこと
- 意味のない装飾や余分な要素を追加しないこと
- アクター間の相互作用の時系列を無視した図を作成しないこと
- `near`は使用しないこと
- 抽象化のレベルを混在させないこと（詳細度を一貫させる）
- 出力内容にオプションの設定値などを記載した余計なコメントは含めない

出力フォーマット
-------------------------

[出力内容のサンプル](../examples/d2_sequence.d2)

出力先ファイル名および命名規則
-------------------------

### ファイル配置ルール

- 出力ファイル: `docs/workflow/{業務プロセス(英語小文字、アンダースコア区切り)}_sequence.d2`
- ディレクトリが存在しない場合は作成する

### ファイル名の命名規則

- 日本語の業務名・プロセス名を英語に翻訳し、小文字で記述する
- 複数単語の場合はアンダースコア（`_`）で区切る
- 動詞+名詞の形式を推奨（例: `process_payment`, `validate_input`）
- 例: `docs/workflow/order_management_sequence.d2`
- 例: `docs/workflow/issue_management_sequence.d2`

参考情報
-------------------------

- [D2言語公式ドキュメント](https://d2lang.com/)
- [D2シーケンス図リファレンス](https://d2lang.com/tour/sequence-diagrams/)
