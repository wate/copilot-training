---
mode: agent
model: Claude Sonnet 4
---
URL抽出
=========================

役割
-------------------------

[テクニカルライター](../chatmodes/technical-writer.chatmode.md)

タスク固有の追加専門性
-------------------------

- Webスクレイピング技術とHTMLパース技法
- 内部リンクと参考資料URLの効率的な抽出
- 構造化されたMarkdown形式での出力

指示
-------------------------

### 基本処理手順

以下の順序でURL抽出を実行する

#### Step 1: ページアクセス

- 指定されたURLにHTTPリクエストでアクセスし、HTMLソースを取得する

#### Step 1.5: メインコンテンツ抽出

- 明示的な抽出箇所の指定がない場合はHTMLからヘッダー、フッター、ナビゲーション、サイドバー等を除外し、メインコンテンツ領域のみを抽出対象とする
- 以下の優先順位でメインコンテンツ領域を特定する
    1. `<main>`タグ内のコンテンツ
    2. `<article>`タグ内のコンテンツ  
    3. id属性が"main", "content", "article"等を含む要素
    4. class属性が"main", "content", "article"等を含む要素
    5. 上記が見つからない場合は`<body>`タグ内の全コンテンツから、明らかなヘッダー・フッター・ナビゲーション要素を除外
- 特定の抽出範囲の指定がある場合は、指定された範囲のみを対象とする

#### Step 2: URL抽出

- 特定されたメインコンテンツ領域内のHTMLの`<a>`タグのhref属性からリンクURLを抽出する
- 特定されたメインコンテンツ領域内のPDF等のドキュメントファイルのURLを抽出する

#### Step 3: URL分類

以下の基準でURLを分類する

- 内部リンク: 同一ドメイン内のページへのリンク
- ドキュメント: PDF、Word、Excel等のドキュメントファイル

#### Step 4: データ処理

- 重複URLを除去する
- 相対パスを絶対パスに変換する
- フラグメント（#以降）を除去する
- URLエンコーディングを適切にデコードする

#### Step 5: 出力生成

- Markdownリスト形式で整理する
- リンクテキストまたは適切な説明文を併記する

### 技術要件

- HTTPリクエストでHTMLを取得し、HTMLパーサーで解析する
- ページ取得タイムアウトは30秒に設定する
- エラーハンドリングを適切に実装する
- メモリ使用量を最適化する

禁止事項
-------------------------

### 処理制約

- 認証が必要なページへのアクセスは行わない
- robots.txtで禁止されているURLへのアクセスは避ける
- 過度なリクエスト頻度でサーバーに負荷をかけない
- 個人情報や機密情報を含むURLは抽出対象から除外する
- CSS、JavaScript、フォント等の技術的リソースは抽出対象から除外する
- 外部ドメインへのリンクは抽出対象から除外する

### 出力制約

- 不正なURLやmalformedなURLは出力しない
- 空のリンクテキストや意味不明な説明は記載しない
- 同一URLの重複出力は行わない
- 500件を超える大量URLリストは要約形式で出力する

### セキュリティ制約

- XSSやインジェクション攻撃のリスクがあるURLは除外する
- 外部リダイレクトを経由する怪しいURLは除外する

出力フォーマット
-------------------------

```md
URL抽出結果
=========================

対象URL: https://example.com/page

内部リンク
-------------------------

- [ホーム](https://example.com/)
- [会社概要](https://example.com/about)
- [お問い合わせ](https://example.com/contact)
- [製品一覧](https://example.com/products)
- [サポート](https://example.com/support)

ドキュメント
-------------------------

- [製品カタログ](https://example.com/downloads/catalog.pdf)
- [操作マニュアル](https://example.com/downloads/manual.pdf)
```

出力先ファイル名および命名規則
-------------------------

### ファイル配置ルール

- 抽出結果ファイル: `extract_urls_{YYYYMMDD}_{hhmmss}.md`
    - URL抽出結果とエラー情報を含む統合ファイル

### 命名規則

- 基本形式: `extract_urls_{抽出日時}.md`
- 日時形式: YYYYMMDD（例: 20250802_123456）

### ファイル内容構成

1. ヘッダー情報（対象URL）
2. 内部リンク一覧
3. 画像・メディア一覧
4. ドキュメント一覧
